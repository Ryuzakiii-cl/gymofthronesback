{% extends 'core/base_dashboard.html' %}
{% load static %}

{% block title %}Usuarios{% endblock %}

{% block content %}
<div class="container mt-3">
<div class="d-flex justify-content-between align-items-center mb-3">
  <h3 class="fw-bold text-dark">üë§ Lista de Usuarios</h3>
  <div class="d-flex gap-2">
    <form action="{% url 'carga_usuarios' %}" method="POST" enctype="multipart/form-data" id="formCarga">
      {% csrf_token %}
      <label class="btn btn-outline-dark fw-bold mb-0">
        ‚¨ÜÔ∏è Cargar Archivo
        <input type="file" name="archivo" accept=".xlsx,.xls,.csv" hidden onchange="document.getElementById('formCarga').submit();">
      </label>
    </form>
    <a href="{% url 'crear_usuario' %}" class="btn btn-dark text-warning fw-bold">
      + Nuevo Usuario
    </a>
  </div>
</div>


  <div class="table-responsive">
    <table class="table table-striped align-middle shadow-sm">
      <thead class="table-dark">
        <tr>
          <th>RUT</th>
          <th>Nombre</th>
          <th>Correo</th>
          <th>Rol</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for usuario in usuarios %}
        <tr>
          <td>{{ usuario.rut_formateado }}</td>

          <td>{{ usuario.nombre }} {{ usuario.apellido }}</td>
          <td>{{ usuario.correo }}</td>
          <td class="text-capitalize">{{ usuario.rol }}</td>
          <td>
            {% if usuario.is_active %}
              <span class="badge bg-success">Activo</span>
            {% else %}
              <span class="badge bg-secondary">Inactivo</span>
            {% endif %}
          </td>
          <td>
            <a href="{% url 'editar_usuario' usuario.id %}" class="btn btn-sm btn-outline-dark">‚úèÔ∏è</a>
            <a href="{% url 'eliminar_usuario' usuario.id %}" class="btn btn-sm btn-outline-danger eliminar-usuario">üóëÔ∏è</a>
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="6" class="text-center">No hay usuarios registrados.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}

{% block extra_js %}

{% if messages %}
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
    {% for msg in messages %}
      Swal.fire({
        icon: '{{ msg.tags }}' === 'error' ? 'error' : 'success',
        title: '{{ msg|escapejs }}',
        confirmButtonColor: '#111',
      });
    {% endfor %}
  </script>
{% endif %}

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="{% static 'js/users/lista_usuarios.js' %}"></script>
{% endblock %}
