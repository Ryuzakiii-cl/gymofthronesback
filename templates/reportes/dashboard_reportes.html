{% extends 'core/base_dashboard.html' %}
{% load static %}
{% load humanize %}

{% block title %}Reportes y Finanzas{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/reportes/dashboard_reportes.css' %}">

<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="fw-bold text-dark"><img src="{% static 'img/grafico.png' %}" alt="icono planes"> Panel de Reportes y Finanzas</h3>

    <form method="get" class="d-flex gap-2 align-items-center">
      <input type="date" name="inicio" value="{{ inicio|date:'Y-m-d' }}" class="form-control">
      <input type="date" name="fin" value="{{ fin|date:'Y-m-d' }}" class="form-control">
      <select name="tipo" class="form-select">
        <option value="socios" {% if tipo == 'socios' %}selected{% endif %}>ğŸ‘¥ Socios</option>
        <option value="finanzas" {% if tipo == 'finanzas' %}selected{% endif %}>ğŸ’° Finanzas</option>
        <option value="actividad" {% if tipo == 'actividad' %}selected{% endif %}>ğŸ‹ï¸ Actividad</option>
      </select>
      <button type="submit" class="btn btn-dark text-warning fw-bold">Filtrar</button>
      <a href="{% url 'exportar_excel' %}?tipo={{ tipo }}" 
         class="btn btn-success fw-bold d-flex align-items-center gap-2 shadow-sm export-btn">
        Exportar <i class="ph ph-file-xls" style="font-size: 1.3rem;"></i>
      </a>
    </form>
  </div>

  <!-- Tarjetas de resumen -->
  <div class="row g-4 mb-4">
    <div class="col-md-2">
      <div class="card card-resumen text-center"><div class="card-body">
        <h6>Socios activos</h6><h3 class="fw-bold">{{ socios_activos }}</h3>
      </div></div>
    </div>
    <div class="col-md-2">
      <div class="card card-resumen text-center"><div class="card-body">
        <h6>Ingresos totales 2025</h6><h3 class="fw-bold">${{ ingresos_totales }}</h3>
      </div></div>
    </div>
    <div class="col-md-2">
      <div class="card card-resumen text-center"><div class="card-body">
        <h6>Reservas totales</h6><h3 class="fw-bold">{{ reservas_totales }}</h3>
      </div></div>
    </div>
    <div class="col-md-2">
      <div class="card card-resumen text-center"><div class="card-body">
        <h6>Talleres activos</h6><h3 class="fw-bold">{{ clases_activas }}</h3>
      </div></div>
    </div>
    <div class="col-md-2">
      <div class="card card-resumen text-center"><div class="card-body">
        <h6>OcupaciÃ³n actual</h6><h3 class="fw-bold">{{ ocupacion }}%</h3>
      </div></div>
    </div>
  </div>

  <!-- GrÃ¡ficos -->
  <div class="row">
    <div class="col-md-6 mb-4">
      <div class="card card-grafico"><div class="card-body">
        <h6 class="fw-bold mb-2">ğŸ‘¥ Socios por tipo de plan</h6>
        <canvas id="grafico_socios_plan"></canvas>
      </div></div>
    </div>

    <div class="col-md-6 mb-4">
      <div class="card card-grafico"><div class="card-body">
        <h6 class="fw-bold mb-2">ğŸ¥§ DistribuciÃ³n de socios por plan</h6>
        <canvas id="grafico_donut"></canvas>
      </div></div>
    </div>

    <div class="col-md-12 mb-4">
      <div class="card card-grafico"><div class="card-body">
        <h6 class="fw-bold mb-2">ğŸ“ˆ EvoluciÃ³n mensual de socios activos</h6>
        <canvas id="grafico_linea"></canvas>
      </div></div>
    </div>

    <div class="col-md-12 mb-4">
      <div class="card card-grafico"><div class="card-body">
        <h6 class="fw-bold mb-2">ğŸ“Š Crecimiento por tipo de plan</h6>
        <canvas id="grafico_area"></canvas>
      </div></div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>


<script>
  window.datosReportes = {
    sociosPorPlan: {{ socios_por_plan|safe }},
    ingresosPorPlan: {{ ingresos_por_plan|safe }},
    meses: {{ meses|safe }},
    totalesMes: {{ totales_mes|safe }},
    mesesCrec: {{ meses_crecimiento|safe }},
    datasetsCrec: {{ datasets_crecimiento|safe }}
  };
</script>



<script src="{% static 'js/reportes/dashboard_reportes.js' %}"></script>

{% endblock %}
