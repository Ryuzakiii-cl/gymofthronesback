<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Mis Clases - Profesor</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .asistio { background-color: #d1e7dd; }
    .ausente { background-color: #f8d7da; }
    .pendiente { background-color: #fff3cd; }
  </style>
</head>
<body class="bg-light">
<div class="container py-4">
  <h2 class="text-center mb-4">📋 Mis Clases</h2>

  {% if clases %}
    {% for clase in clases %}
      <div class="card mb-4 shadow-sm">
        <div class="card-header bg-dark text-white d-flex justify-content-between">
          <strong>{{ clase.nombre }}</strong>
          <span>{{ clase.fecha|date:"d/m/Y" }} {{ clase.hora_inicio }} - {{ clase.hora_fin }}</span>
        </div>
        <div class="card-body">
          <p><strong>Descripción:</strong> {{ clase.descripcion|default:"Sin descripción" }}</p>
          <p><strong>Cupos:</strong> {{ clase.cupos }} |
             <strong>Inscritos:</strong> {{ clase.inscripciones.count }}</p>

          {% if clase.inscripciones.all %}
            <table class="table table-sm align-middle">
              <thead>
                <tr class="table-dark">
                  <th>Socio</th>
                  <th>Estado</th>
                  <th>Asistencia</th>
                  <th>Acción</th>
                </tr>
              </thead>
              <tbody>
                {% for inscripcion in clase.inscripciones.all %}
                  <tr class="{{ inscripcion.asistencia }}">
                    <td>{{ inscripcion.socio.nombre }} {{ inscripcion.socio.apellido_paterno }}</td>
                    <td>
                      {% if inscripcion.estado == 'inscrito' %}
                        <span class="badge bg-success">Inscrito</span>
                      {% else %}
                        <span class="badge bg-secondary">Cancelado</span>
                      {% endif %}
                    </td>
                    <td>{{ inscripcion.get_asistencia_display }}</td>
                    <td>
                      {% if inscripcion.asistencia == 'pendiente' %}
                        <form method="POST" class="d-inline">
                          {% csrf_token %}
                          <input type="hidden" name="inscripcion_id" value="{{ inscripcion.id }}">
                          <button name="asistencia" value="asistio" class="btn btn-sm btn-success">Asistió</button>
                          <button name="asistencia" value="ausente" class="btn btn-sm btn-danger">Ausente</button>
                        </form>
                      {% else %}
                        <small class="text-muted">Marcado</small>
                      {% endif %}
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          {% else %}
            <p class="text-muted">No hay socios inscritos aún.</p>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  {% else %}
    <p class="text-center text-muted">No tienes clases asignadas.</p>
  {% endif %}
</div>
</body>
</html>
