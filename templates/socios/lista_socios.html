{% extends 'core/base_dashboard.html' %}
{% load static %}

{% block title %}Lista de Socios{% endblock %}

{% block content %}
<div class="container mt-3">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="fw-bold">
      <img src="{% static 'img/socios.png' %}" alt="icono socios"> Lista de Socios
    </h3>
    <a href="{% url 'crear_socio' %}" class="btn btn-dark text-warning fw-bold">+ Nuevo Socio</a>
  </div>

  <!-- üîç Barra de b√∫squeda -->
  <div class="input-group mb-3">
    <span class="input-group-text">
      <img src="{% static 'img/lupa.gif' %}" alt="icono de b√∫squeda">
    </span>
    <input
      type="text"
      id="buscador"
      class="form-control"
      placeholder="Buscar por nombre o apellido..."
    >
    <button
      class="btn btn-outline-secondary"
      type="button"
      id="btnLimpiar"
      title="Limpiar b√∫squeda"
    >‚ùå</button>
  </div>

  <div class="table-responsive">
    <table class="table table-striped align-middle shadow-sm" id="tablaSocios">
      <thead class="table-dark">
        <tr>
          <th>RUT</th>
          <th>Nombre</th>
          <th>Correo</th>
          <th>Tel√©fono</th>
          <th>Estado</th>
          <th>Plan</th>
          <th>Vigencia</th>
          <th>Profesor Asignado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for socio in socios %}
        <tr>
          <td>{{ socio.rut_formateado }}</td>
          <td>{{ socio.nombre }} {{ socio.apellido_paterno }} {{ socio.apellido_materno }}</td>
          <td>{{ socio.correo }}</td>
          <td>
            {% if socio.telefono %}
              +56{{ socio.telefono }}
            {% else %}
              -
            {% endif %}
          </td>
          <td>
            {% if socio.estado %}
              <span class="badge bg-success">Activo</span>
            {% else %}
              <span class="badge bg-secondary">Inactivo</span>
            {% endif %}
          </td>
          <td>{{ socio.plan_nombre|default:"Sin plan" }}</td>
          <td>
            {% if socio.plan_vigencia != "-" %}
              <span class="badge bg-primary">{{ socio.plan_vigencia }}</span>
            {% else %}
              -
            {% endif %}
          </td>
          <td>
            {% if socio.profesor_asignado %}
              {{ socio.profesor_asignado.nombre }} {{ socio.profesor_asignado.apellido }}
              <br>
              <small class="text-muted">
                {{ socio.profesor_asignado.get_especialidad_display }}
              </small>
            {% else %}
              <span class="text-muted fst-italic">No asignado</span>
            {% endif %}
          </td>
          <td>
            <a href="{% url 'editar_socio' socio.id %}" class="btn btn-sm btn-outline-dark" title="Editar">
              ‚úèÔ∏è
            </a>
            <a href="{% url 'eliminar_socio' socio.id %}" class="btn btn-sm btn-outline-danger eliminar-socio" title="Eliminar">
              üóëÔ∏è
            </a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="9" class="text-center">No hay socios registrados.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="{% static 'js/socios/lista_socios.js' %}"></script>
{% endblock %}
