{% extends 'core/base_dashboard.html' %}
{% load static %}

{% block title %}Crear Rutina Base{% endblock %}

{% block content %}
<div class="container mt-4">
  <h3 class="fw-bold mb-4">Crear Plantilla de Rutina</h3>

  <form method="POST" id="form-rutina" class="card p-4 shadow-sm">
    {% csrf_token %}

    <!-- Datos generales -->
    <div class="row mb-3">
      <div class="col-md-6">
        <label class="form-label">Título</label>
        <input type="text" name="titulo" class="form-control" required>
      </div>

      <div class="col-md-3">
        <label class="form-label">Objetivo</label>
        <select name="objetivo" class="form-select" required>
          <option value="" disabled selected>Seleccionar...</option>
          <option value="bajar_peso">Bajar de peso</option>
          <option value="subir_masa">Subir masa muscular</option>
          <option value="bajar_grasa">Bajar grasa</option>
          <option value="mantener">Mantener</option>
          <option value="aumentar_fuerza">Aumentar fuerza</option>
          <option value="tonificar">Tonificar</option>
        </select>
      </div>

      <div class="col-md-3">
        <label class="form-label">IMC (mín - máx)</label>
        <div class="d-flex gap-2">
          <input type="number" step="0.1" name="imc_min" class="form-control">
          <input type="number" step="0.1" name="imc_max" class="form-control">
        </div>
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label">Descripción</label>
      <textarea name="descripcion" class="form-control" rows="2"></textarea>
    </div>

    <hr class="my-4">

    <!-- Editor de ejercicios -->
    <h5 class="fw-bold mb-3">Editor de contenido (ejercicios)</h5>

    <!-- Controles para agregar filas -->
    <div class="row g-2 mb-3">
      <div class="col-md-2">
        <label class="form-label">Semana</label>
        <select id="semana-select" class="form-select form-select-sm">
          <option value="1">Semana 1</option>
          <option value="2">Semana 2</option>
          <option value="3">Semana 3</option>
          <option value="4">Semana 4</option>
        </select>
      </div>

      <div class="col-md-2">
        <label class="form-label">Día</label>
        <input type="number" id="dia-input" min="1" max="7"
               class="form-control form-control-sm" value="1">
      </div>

      <div class="col-md-3">
        <label class="form-label">Ejercicio</label>
        <select id="ejercicio-select" class="form-select form-select-sm">
          <option value="Sentadilla">Sentadilla</option>
          <option value="Flexiones">Flexiones</option>
          <option value="Abdominales">Abdominales</option>
          <option value="Zancadas">Zancadas</option>
          <option value="Plancha">Plancha</option>
          <option value="Remo con mancuerna">Remo con mancuerna</option>
          <option value="Saltos estrella">Saltos estrella</option>
          <option value="Peso muerto con mancuerna">Peso muerto con mancuerna</option>
          <option value="Otro">Otro (escribir)</option>
        </select>
      </div>

      <div class="col-md-2">
        <label class="form-label">Series</label>
        <input type="number" id="series-input" class="form-control form-control-sm" value="3">
      </div>

      <div class="col-md-3">
        <label class="form-label">Reps / Descanso</label>
        <div class="d-flex gap-2">
          <input type="text" id="reps-input" class="form-control form-control-sm" placeholder="12 reps">
          <input type="text" id="descanso-input" class="form-control form-control-sm" placeholder="60''">
        </div>
      </div>
    </div>

    <div class="mb-3">
      <input type="text" id="ejercicio-personalizado"
             class="form-control form-control-sm d-none"
             placeholder="Nombre del ejercicio (si elegiste 'Otro')">
    </div>

    <button type="button" id="btn-agregar-fila"
            class="btn btn-sm btn-outline-dark mb-3">
      + Agregar ejercicio
    </button>

    <table class="table table-bordered">
      <thead class="table-dark">
        <tr>
          <th>Semana</th>
          <th>Día</th>
          <th>Ejercicio</th>
          <th>Series</th>
          <th>Reps</th>
          <th>Descanso</th>
          <th>Acciones</th>
        </tr>
      </thead>

      <tbody id="tabla-ejercicios">
        <!-- Se llena dinámicamente -->
      </tbody>
    </table>

    <!-- Input hidden donde irá el JSON final -->
    <input type="hidden" name="contenido" id="contenido-json">

    <!-- Botones -->
    <div class="d-flex justify-content-between mt-3">
      <button type="submit" class="btn btn-dark text-warning fw-bold">
        Crear Rutina
      </button>
      <a href="{% url 'lista_rutinas' %}" class="btn btn-secondary">
        Cancelar
      </a>
    </div>
  </form>


{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
  // JSON inicial vacío
  const RUTINA_JSON_INICIAL = {};
</script>

<script src="{% static 'js/rutinas/rutinas.js' %}"></script>
{% endblock %}
